<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
		<script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
		<script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>
		<script src="onclick.js"></script>
		<script src="howler.js"></script>

		<script>
		  function greg(){
			var win = window.open("https://www.clubic.com/snapchat/actualite-3102-comment-creer-un-compte-snapchat-.html", '_blank');
			 win.focus();
			}
		</script>
		
		<script>
		AFRAME.registerComponent("model-opacity", {
			  schema: {
				opacity: { type: "number", default: 0.5 }
			  },
			  init: function() {
				this.el.addEventListener("model-loaded", this.update.bind(this));
			  },
			  update: function() {
				var mesh = this.el.getObject3D("mesh");
				var data = this.data;
				if (!mesh) {
				  return;
				}
				mesh.traverse(function(node) {
				  if (node.isMesh) {
					<!-- console.log(node); -->
					node.material.opacity = data.opacity;
					node.material.transparent = data.opacity < 1.0;
					node.material.needsUpdate = true;
				  }
				});
			  }
			});		
		</script>
		
		<script>
		AFRAME.registerComponent("model-opacity2", {
			  schema: {
				opacity: { type: "number", default: 0.5 }
			  },
			  init: function() {
				this.el.addEventListener("model-loaded", this.update.bind(this));
			  },
			  update: function() {
				var mesh = this.el.getObject3D("mesh");
				var data = this.data;
				if (!mesh) {
				  return;
				}
				mesh.traverse(function(node) {
				  if (node.isMesh) {
					node.material.opacity = data.opacity;
					node.material.needsUpdate = true;
				  }
				});
			  }
			});		
		</script>
		
		<script>
			var sound = new Howl({
			  src: ['sound.mp3']
			});
		</script>
		
		<script>
				
				var scrollpos = 6
				var depart = 0
				
				
				function posForEl(el) {
						let pos = el.object3D.position
						return `${pos.x} ${pos.y} ${pos.z}`
						}
						
				function posForEl2(el) {
						let pos = el.object3D.position
						return `${pos.x} ${pos.y} ${pos.z + 5}`
						}
		</script>
	</head>

	<body>
		<a-scene id="scene">
			<!-- Musique de fond -->
			<!-- <a-sound src="Caketown.mp3" autoplay="true" loop="true" position="0 0 0"></a-sound> -->
			
			<!-- <a-assets> -->
				<!-- <audio id="son" src="Caketown.mp3" ></audio> -->
			<!-- </a-assets> -->
			
			<a-assets>
				<a-mixin id="clickable" onclick='greg'></a-mixin>
				<a-mixin id="clickson" ></a-mixin>
				
				<!-- position initiale de la camÃ©ra -->
				<a-mixin id="campos" position="0 0 8"></a-mixin>
				
				<!-- couleur et forme -->
				<a-mixin id="box" visible=false material="color: red" geometry="primitive: box; width: 2; height: 2; depth: 2"></a-mixin>
				
			</a-assets>
			
			<a-assets>
				<img id="ballon" src="paques_2022.png" transparent="true">
            </a-assets>
			
			<a-assets>
                <a-asset-item id="lapinos" src="lapin2_2022.glb"></a-asset-item>
            </a-assets>
			
			<a-assets>
                <a-asset-item id="M" src="Marcheprime.glb"></a-asset-item>
            </a-assets>
			<a-assets>
                <a-asset-item id="A" src="Marcheprime_a.glb"></a-asset-item>
            </a-assets>
			<a-assets>
                <a-asset-item id="R" src="Marcheprime_r.glb"></a-asset-item>
            </a-assets>
			<a-assets>
                <a-asset-item id="C" src="Marcheprime_c.glb"></a-asset-item>
            </a-assets>
			<a-assets>
                <a-asset-item id="H" src="Marcheprime_h.glb"></a-asset-item>
            </a-assets>
			<a-assets>
                <a-asset-item id="E" src="Marcheprime_e.glb"></a-asset-item>
            </a-assets>
			<a-assets>
                <a-asset-item id="P" src="Marcheprime_p.glb"></a-asset-item>
            </a-assets>
			<a-assets>
                <a-asset-item id="R2" src="Marcheprime_r2.glb"></a-asset-item>
            </a-assets>
			<a-assets>
                <a-asset-item id="I" src="Marcheprime_i.glb"></a-asset-item>
            </a-assets>
			<a-assets>
                <a-asset-item id="M2" src="Marcheprime_m.glb"></a-asset-item>
            </a-assets>
			<a-assets>
                <a-asset-item id="E2" src="Marcheprime_e2.glb"></a-asset-item>
            </a-assets>
			
			<a-assets>
				<img id="ground" src="ray_bleu_clair.jpg">
			</a-assets>
			
			<a-assets>
				<img id="etape1" src="etape1.png">
			</a-assets>
			
			<a-assets>
				<img id="etape2" src="etape2.png">
			</a-assets>
			
			<a-assets>
				<img id="etape3" src="etape3.png">
			</a-assets>
			<a-assets>
				<img id="etape3b" src="etape3b.png">
			</a-assets>
			
			<a-assets>
				<img id="etape4" src="etape4.png">
			</a-assets>
			
			<a-assets>
				<img id="etape5" src="etape5.png">
			</a-assets>
			
			<a-assets>
				<img id="hp" src="HP.png">
			</a-assets>
			
			<!-- Image Titre -->
			<a-plane id ="tPaques" src="#ballon" transparent="true" height="10.14" width="40.65" position="0 13 -29"></a-plane>
			
			<a-plane id ="tetape1" visible=false src="#etape1" transparent="true" height="18.35" width="21.54" position="13 0 -10"></a-plane>
			
			<a-plane id ="tetape2" mixin="clickable" class="greg" visible=false src="#etape2" transparent="true" height="18.35" width="21.54" position="-13 -100 -10"></a-plane>
			
			<a-plane id ="tetape3" visible=false src="#etape3" transparent="true" height="18.35" width="21.54" position="-16 0 -10"></a-plane>
			<a-plane id ="tetape3b" visible=false src="#etape3b" transparent="true" height="18.35" width="21.54" position="16 0 -10"></a-plane>
			
			<a-plane id ="tetape4" visible=false src="#etape4" transparent="true" height="18.35" width="21.54" position="13 0 -10"></a-plane>
			
			<a-plane id ="tetape5" visible=false src="#etape5" transparent="true" height="18.35" width="21.54" position="13 0 -10"></a-plane>
			
			<a-plane id ="thp" mixin="clickson" class="greg" visible=true src="#hp" transparent="true" height="3.2" width="3.2" position="15 13 -10"></a-plane>
			
			<!-- Image de Fond -->
			<a-plane src="#ground" height="100" width="100" rotation="0 0 0" position="0 0 -20"></a-plane>

			<a-entity id="lapin" gltf-model="#lapinos" class="toto" position="0 0 0" rotation="0 0 0" visible=false ></a-entity>
            <a-entity id="villeM" gltf-model="#M" class="titres" position="0 -1.5 -3" rotation="-20 0 0" ></a-entity>
            <a-entity id="villeA" gltf-model="#A" class="titres" position="1.6 -1.5 -1.5" rotation="-20 -10 0" ></a-entity>
            <a-entity id="villeR" gltf-model="#R" class="titres" position="3.2 -1.5 -1.5" rotation="-20 -10 0" ></a-entity>
            <a-entity id="villeC" gltf-model="#C" class="titres" position="4.8 -1.5 -1.5" rotation="-20 -10 0" ></a-entity>
            <a-entity id="villeH" gltf-model="#H" class="titres" position="6.4 -1.5 -1.5" rotation="-20 -10 0" ></a-entity>
            <a-entity id="villeE" gltf-model="#E" class="titres" position="8 -1.5 -2" rotation="-20 -5 0" ></a-entity>
            <a-entity id="villeP" gltf-model="#P" class="titres" position="9.6 -1.5 -3" rotation="-20 0 0" ></a-entity>
            <a-entity id="villeR2" gltf-model="#R2" class="titres" position="11.2 -1.5 -3" rotation="-20 0 0" ></a-entity>
            <a-entity id="villeI" gltf-model="#I" class="titres" position="12.8 -1.5 -3" rotation="-20 0 0" ></a-entity>
            <a-entity id="villeM2" gltf-model="#M2" class="titres" position="14.4 -1.5 -3" rotation="-20 0 0" ></a-entity>
            <a-entity id="villeE2" gltf-model="#E2" class="titres" position="16 -1.5 -3" rotation="-20 0 0" ></a-entity>
			
			<a-entity id="texte" position="0 -3 0" transparent="true" text="color: blue; align: center; width: 20; ">
			</a-entity>
			
			<a-entity id="aidegif" visible=false scale="3 3 0" position="10 1 0" geometry="primitive:plane;" material="shader:gif; src:url(aide_souris.gif); transparent:true"></a-entity>
			<a-entity id="aidetxt" visible=false position="10 -0.5 0" transparent="true" text="color: black; align: center; value:Actionnez la molette\npour tourner les pages; width: 6; "></a-entity>
						
			<!-- Camera -->
			<a-entity id="camera-rig" class="toto" mixin="campos">
			  <a-entity camera cursor="ray-origin: mouse" raycaster="objects: .greg"></a-entity>
			</a-entity>
			
			<!-- <a-entity sound="src: #son" preload="auto" autoplay="true" loop="true" position="0 0 0"></a-entity> -->
			
			<script>
					window.addEventListener('wheel', function (e) {
							const listepoi = ["-5 1 -5","-1 1 0","-5 3 3","2.5 1.5 2.5","3 1 -4","-5 1 3"]
							const camRig = document.querySelector('#camera-rig')
							let lapin = document.querySelector('#lapin')
							let titrePaques = document.querySelector('#tPaques')
							let titret1 = document.querySelector('#tetape1')
							let titret2 = document.querySelector('#tetape2')
							let titret3 = document.querySelector('#tetape3')
							let textepos = document.querySelector('#texte')
							let aide = document.querySelector('#aidegif')
							let aide2 = document.querySelector('#aidetxt')
							
														
							var sceneEl = document.querySelector('a-scene');
							var allObjects = document.querySelectorAll('.titres');
							
							if (e.deltaY < 0) {
								scrollpos += 1
								
								if (scrollpos > listepoi.length) {
										scrollpos = listepoi.length
									}
									
								if (scrollpos == 1) {
										<!-- affichage etape5 -->
										tetape5.setAttribute('visible', true);
										<!-- masque etape4 -->
										tetape4.setAttribute('visible', false);
									}
										
								if (scrollpos == 2) {
										<!-- masque etape3 -->
										tetape3.setAttribute('visible', false);
										<!-- masque etape3b -->
										tetape3b.setAttribute('visible', false);
										<!-- affichage etape4 -->
										tetape4.setAttribute('visible', true);
										<!-- masque etape5 -->
										tetape5.setAttribute('visible', false);
										
									}
										
								if (scrollpos == 3) {
										lapin.setAttribute('animation-mixer',{clip: "Vrille_vers_Gauche_rev", loop: "once", clampWhenFinished: "true"});
										
										<!-- masque etape2 -->
										tetape2.setAttribute('visible', false);
										tetape2.setAttribute('position', "-13 -100 -10");
										<!-- masque etape4 -->
										tetape4.setAttribute('visible', false);
										<!-- affiche etape3 -->
										tetape3.setAttribute('visible', true);
										<!-- affiche etape3b -->
										tetape3b.setAttribute('visible', true);
										<!-- masque etape5 -->
										tetape5.setAttribute('visible', false);
									}
										
								if (scrollpos == 4) {
										lapin.setAttribute('animation-mixer',{clip: "Centre_3/4_3_rev", loop: "once", clampWhenFinished: "true"});
										<!-- affiche etape2 -->
										tetape2.setAttribute('visible', true);
										tetape2.setAttribute('position', "-13 0 -10");
										<!-- masuue etape3 -->
										tetape3.setAttribute('visible', false);
										<!-- masque etape3b -->
										tetape3b.setAttribute('visible', false);
									}
										
								if (scrollpos == 5) {
										lapin.setAttribute('animation-mixer',{clip: "3/4_vers_Droit_rev", loop: "once", clampWhenFinished: "true"});
										<!-- affiche etape1 -->
										tetape1.setAttribute('visible', true);
										<!-- masque etape2 -->
										tetape2.setAttribute('visible', false);
										tetape2.setAttribute('position', "-13 -100 -10");
									}
										
								if (scrollpos == 6) {
										lapin.setAttribute('animation-mixer',{clip: "Rotation_vers_Gauche_rev", loop: "once", clampWhenFinished: "true"});
										titrePaques.setAttribute('animation', `property: model-opacity2.opacity; from: 0; to: 1;dur: 500`);
										aide.setAttribute('visible', true);
										aide2.setAttribute('visible', true);
										
										allObjects.forEach(element => {
											element.setAttribute('animation', `property: model-opacity.opacity;from: 0; to: 1;dur: 500`);
										});
										<!-- masque etape1 -->
										tetape1.setAttribute('visible', false);
									}
									
								
								}
								
							if (e.deltaY > 0) {
								
								scrollpos -= 1
								
								if (scrollpos < 0) {
										scrollpos = 0
									}	
									
								if (scrollpos == 1) {
										console.log("en position 1")
										<!-- affichage etape4 -->
										tetape4.setAttribute('visible', false);
										<!-- affichage etape5 -->
										tetape5.setAttribute('visible', true);
									}
										
								if (scrollpos == 2) {
										
										<!-- OK GREG ANIM LAPIN -->
										lapin.setAttribute('animation-mixer',{clip: "Vrille_vers_Gauche", loop: "once", clampWhenFinished: "true"});
										<!-- OK GREG ANIM LAPIN -->
										<!-- masque etape3 -->
										tetape3.setAttribute('visible', false);
										<!-- masque etape3b -->
										tetape3b.setAttribute('visible', false);
										<!-- affichage etape4 -->
										tetape4.setAttribute('visible', true);
										<!-- masque etape5 -->
										tetape5.setAttribute('visible', false);
										
									}
										
								if (scrollpos == 3) {
										lapin.setAttribute('animation-mixer',{clip: "Centre_3/4_3", loop: "once", clampWhenFinished: "true"});
										<!-- masque etape2 -->
										tetape2.setAttribute('visible', false);
										tetape2.setAttribute('position', "-13 -100 -10");
										<!-- affiche etape3 -->
										tetape3.setAttribute('visible', true);
										<!-- affiche etape3b -->
										tetape3b.setAttribute('visible', true);
									}
										
								if (scrollpos == 4) {
										lapin.setAttribute('animation-mixer',{clip: "3/4_vers_Droit", loop: "once", clampWhenFinished: "true"});
										
										<!-- masque etape1 -->
										tetape1.setAttribute('visible', false);
										<!-- affiche etape2 -->
										tetape2.setAttribute('visible', true);
										tetape2.setAttribute('position', "-13 0 -10");
									}
										
								if (scrollpos == 5) {
										lapin.setAttribute('animation-mixer',{clip: "Rotation_vers_Gauche", loop: "once", clampWhenFinished: "true"});
										titrePaques.setAttribute('animation', `property: model-opacity2.opacity; from: 1; to: 0;dur: 500`);
										aide.setAttribute('visible', false);
										aide2.setAttribute('visible', false);
										
										allObjects.forEach(element => {
											element.setAttribute('animation', `property: model-opacity.opacity;from: 1; to: 0;dur: 500`);
										});
										<!-- affiche etape1 -->
										tetape1.setAttribute('visible', true);
										<!-- masque etape2 -->
										tetape2.setAttribute('visible', false);
										tetape2.setAttribute('position', "-13 -100 -10");
									}
										
								if (scrollpos == 6) {
									}
								
								}
							});
			</script>
			
			<script>
			window.onload = dep()
				
				function dep() {
						if (depart == 0) {
												let camRig = document.querySelector('#camera-rig')
												let titrePaques = document.querySelector('#tPaques')
												let aide = document.querySelector('#aidegif')
												let aide2 = document.querySelector('#aidetxt')
												let lapin = document.querySelector('#lapin')
												let Mville = document.querySelector('#villeM')
												let Aville = document.querySelector('#villeA')
												let Rville = document.querySelector('#villeR')
												let Cville = document.querySelector('#villeC')
												let Hville = document.querySelector('#villeH')
												let Eville = document.querySelector('#villeE')
												let Pville = document.querySelector('#villeP')
												let R2ville = document.querySelector('#villeR2')
												let Iville = document.querySelector('#villeI')
												let M2ville = document.querySelector('#villeM2')
												let E2ville = document.querySelector('#villeE2')
												
												var sound = new Howl({
													src: ['Caketown.mp3'],
													loop: true,
													volume: 0.5
													});

												sound.play();
												
												<!-- Pause de 2 secondes pour le Lapin -->
												setTimeout(function() {
												Mville.setAttribute('animation-mixer',{clip: "Text.010Action", loop: "once", clampWhenFinished: "true"});
												Aville.setAttribute('animation-mixer',{clip: "Text.010Action.010", loop: "once", clampWhenFinished: "true"});
												Rville.setAttribute('animation-mixer',{clip: "Text.010Action.009", loop: "once", clampWhenFinished: "true"});
												Cville.setAttribute('animation-mixer',{clip: "Text.010Action.008", loop: "once", clampWhenFinished: "true"});
												Hville.setAttribute('animation-mixer',{clip: "Text.010Action.007", loop: "once", clampWhenFinished: "true"});
												Eville.setAttribute('animation-mixer',{clip: "Text.010Action.006", loop: "once", clampWhenFinished: "true"});
												Pville.setAttribute('animation-mixer',{clip: "Text.010Action.005", loop: "once", clampWhenFinished: "true"});
												R2ville.setAttribute('animation-mixer',{clip: "Text.010Action.004", loop: "once", clampWhenFinished: "true"});
												Iville.setAttribute('animation-mixer',{clip: "Text.010Action.003", loop: "once", clampWhenFinished: "true"});
												M2ville.setAttribute('animation-mixer',{clip: "Text.010Action.002", loop: "once", clampWhenFinished: "true"});
												E2ville.setAttribute('animation-mixer',{clip: "Text.010Action.001", loop: "once", clampWhenFinished: "true"});
												}, 1000);
												
												<!-- Pause de 2 secondes -->
												setTimeout(function() {
													 lapin.setAttribute('visible', true);
													 lapin.setAttribute('animation', `property: model-opacity2.opacity;from: 0; to: 1;dur: 1000`);
												}, 3000);
												
												<!-- Pause de 2 secondes -->
												setTimeout(function() {
													 titrePaques.setAttribute('animation', `property: model-opacity2.opacity; from: 0; to: 1;dur: 3000`);
													 titrePaques.setAttribute('animation__2', `property: position; from: 0 30 -19; to: 0 13 -19;dur: 3000`);
												}, 3500);
												
												<!-- Pause de 2 secondes -->
												setTimeout(function() {
													 aide.setAttribute('visible', true);
													 aide2.setAttribute('visible', true);
												}, 8000);
												
												
												
												depart = 1
												console.log("ok depart")
											}
						
						}
			</script>
			
			
		</a-scene>
	</body>
</html>